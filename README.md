# CHTL 编译器

CHTL（超文本语言）编译器是一个基于C++17构建的现代化编译器，用于编译CHTL语法到HTML输出。

## 项目架构

```
┌─────────────────────────────────────────────────────────────────┐
│                         CHTL源代码                               │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    CHTLUnifiedScanner                           │
│                   (精准代码切割器)                               │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
        ┌──────────────┬──────────────┬──────────────┬────────────┐
        │   CHTL片段   │ CHTL JS片段  │   CSS片段    │   JS片段   │
        └──────┬───────┴──────┬───────┴──────┬───────┴──────┬─────┘
               │              │              │              │
               ▼              ▼              ▼              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    CompilerDispatcher                           │
│                   (编译器调度器)                                 │
└──────┬──────────────┬──────────────┬──────────────┬────────────┘
       │              │              │              │
       ▼              ▼              ▼              ▼
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│    CHTL     │ │   CHTL JS   │ │     CSS     │ │JavaScript   │
│  Compiler   │ │  Compiler   │ │  Compiler   │ │  Compiler   │
│  (手写)     │ │  (手写)     │ │  (ANTLR)    │ │  (ANTLR)    │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
       │              │              │              │
       └──────────────┴──────────────┴──────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      编译结果合并                                │
│                     (HTML输出)                                   │
└─────────────────────────────────────────────────────────────────┘
```

## 已完成功能

### ✅ 基础项目结构和构建系统
- CMake构建系统
- 模块化架构设计
- C++17标准支持
- 跨平台兼容性

### ✅ CHTLUnifiedScanner (精准代码切割器)
- 可变长度切片扫描
- 智能片段类型检测
- 基于上下文的切割优化
- 最小单元切割和合并
- 支持CHTL、CHTL JS、CSS、JavaScript片段识别

### ✅ CompilerDispatcher (编译器调度器)
- 多编译器管理和调度
- 并行编译支持
- 结果缓存机制
- 错误收集和报告
- 统计信息收集
- 智能结果合并

### ✅ 核心基础设施
- Token词法分析系统
- AST抽象语法树节点
- Context上下文管理
- 状态机支持
- 文件工具类
- 错误处理系统

## 待实现功能

### 🔄 CHTL编译器 (手写)
- CHTL语法解析
- HTML生成
- 模板系统支持
- 自定义元素处理

### 🔄 CHTL JS编译器 (手写)  
- CHTL JS语法解析
- JavaScript生成
- 选择器增强
- 事件委托支持

### 🔄 CSS编译器 (使用ANTLR)
- CSS语法解析
- 样式优化
- 自动前缀

### 🔄 JavaScript编译器 (使用ANTLR)
- JavaScript语法解析
- 代码优化
- ES6+支持

## 构建和使用

### 依赖要求
- C++17兼容编译器 (GCC 7+, Clang 5+, MSVC 2017+)
- CMake 3.16+

### 构建步骤
```bash
mkdir build
cd build
cmake ..
make
```

### 使用示例
```bash
# 编译CHTL文件
./bin/chtl_compiler input.chtl -o output.html

# 启用调试模式
./bin/chtl_compiler -d input.chtl

# 生成源码映射
./bin/chtl_compiler --source-map input.chtl
```

## 测试

项目包含多个测试程序：

```bash
# 基础类型测试
./simple_test

# 扫描器测试  
./test_scanner

# 编译器调度器测试
./test_compiler
```

## CHTL语法示例

```chtl
html
{
    head
    {
        
    }
    
    body
    {
        div
        {
            id: main-container;
            class: container;
            
            style
            {
                width: 100%;
                max-width: 1200px;
                margin: 0 auto;
                
                .box
                {
                    background-color: #f0f0f0;
                    padding: 20px;
                    border-radius: 5px;
                }
            }
            
            script
            {
                {{.box}}.addEventListener('click', function() {
                    console.log('Box clicked!');
                });
            }
            
            text
            {
                欢迎使用CHTL编译器！
            }
        }
    }
}
```

## 项目状态

当前项目处于早期开发阶段，核心基础设施已完成，正在逐步实现各个编译器模块。

### 完成进度
- [x] 项目架构设计
- [x] 基础设施 (70%)
- [x] 统一扫描器 (90%)
- [x] 编译器调度器 (85%)
- [ ] CHTL编译器 (0%)
- [ ] CHTL JS编译器 (0%)
- [ ] CSS编译器 (0%)
- [ ] JavaScript编译器 (0%)

## 贡献

欢迎贡献代码！请确保：
1. 遵循C++17标准
2. 包含适当的测试
3. 遵循项目的代码风格
4. 更新相关文档

## 许可证

MIT License - 详见 LICENSE 文件。