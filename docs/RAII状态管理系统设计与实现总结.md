# RAIIçŠ¶æ€ç®¡ç†ç³»ç»Ÿè®¾è®¡ä¸å®ç°æ€»ç»“

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æ–‡æ¡£æ€»ç»“äº†ä¸ºCHTLç¼–è¯‘å™¨ç³»ç»Ÿè®¾è®¡å’Œå®ç°çš„RAIIè‡ªåŠ¨åŒ–ç®¡ç†æ¨¡å¼çš„çŠ¶æ€æœº+ä¸Šä¸‹æ–‡ç®¡ç†ååŠ©å™¨ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿä¸¥æ ¼æ ¹æ®`CHTLè¯­æ³•æ–‡æ¡£.md`ä¸­çš„è¯­æ³•å®šä¹‰ï¼Œä¸å¾—ç§è‡ªæ‰©å±•ï¼Œä¸ºè§£æå™¨å’Œç”Ÿæˆå™¨æä¾›ç²¾ç¡®çš„çŠ¶æ€ç®¡ç†ã€‚

## ğŸ¯ è®¾è®¡ç›®æ ‡

### æ ¸å¿ƒéœ€æ±‚
1. **RAIIè‡ªåŠ¨åŒ–ç®¡ç†** - ä½¿ç”¨RAIIæ¨¡å¼è‡ªåŠ¨ç®¡ç†çŠ¶æ€çš„è¿›å…¥å’Œé€€å‡º
2. **çŠ¶æ€æœºç²¾ç¡®æ§åˆ¶** - ä¸ºASTèŠ‚ç‚¹æä¾›ç²¾ç¡®çš„çŠ¶æ€æ ‡è®°
3. **ä¸Šä¸‹æ–‡ç®¡ç†ååŠ©** - ååŠ©è§£æå™¨å’Œç”Ÿæˆå™¨ç»´æŠ¤ä¸Šä¸‹æ–‡ä¿¡æ¯
4. **æ‰«æå™¨é›†æˆ** - ä¸ç°æœ‰æ‰«æå™¨ç³»ç»Ÿæ— ç¼æ­é…ä½¿ç”¨
5. **ç¼–è¯‘å™¨ååŒ** - ä¸ºCHTLå’ŒCHTL JSç¼–è¯‘å™¨æä¾›çŠ¶æ€æ”¯æŒ
6. **ä¸¥æ ¼è¯­æ³•éµå¾ª** - 100%æŒ‰ç…§CHTLè¯­æ³•æ–‡æ¡£å®ç°ï¼Œæ— åå·®

### è®¾è®¡åŸåˆ™
- **è‡ªåŠ¨åŒ–ç®¡ç†** - é€šè¿‡RAIIæ¨¡å¼æ¶ˆé™¤æ‰‹åŠ¨çŠ¶æ€ç®¡ç†é”™è¯¯
- **ç²¾ç¡®çŠ¶æ€è·Ÿè¸ª** - ä¸ºæ¯ä¸ªASTèŠ‚ç‚¹æä¾›è¯¦ç»†çš„çŠ¶æ€ä¿¡æ¯
- **çº¿ç¨‹å®‰å…¨** - æ”¯æŒå¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„çŠ¶æ€ç®¡ç†
- **é«˜æ€§èƒ½** - ä¼˜åŒ–çš„çŠ¶æ€è½¬æ¢å’ŒæŸ¥è¯¢æ€§èƒ½
- **æ˜“äºé›†æˆ** - æä¾›ç®€æ´çš„APIå’Œå®å®šä¹‰
- **å…¨é¢ç›‘æ§** - å®Œæ•´çš„äº‹ä»¶ç›‘å¬å’Œè°ƒè¯•æ”¯æŒ

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒç»„ä»¶æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     RAIIçŠ¶æ€ç®¡ç†ç³»ç»Ÿ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ RAIIçŠ¶æ€æœº      â”‚  â”‚ ä¸Šä¸‹æ–‡ç®¡ç†å™¨     â”‚  â”‚ ASTçŠ¶æ€è¿½è¸ªå™¨   â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚ â”‚
â”‚  â”‚ â€¢ è¯­æ³•çŠ¶æ€ç®¡ç†   â”‚  â”‚ â€¢ ä½œç”¨åŸŸç®¡ç†     â”‚  â”‚ â€¢ èŠ‚ç‚¹çŠ¶æ€è·Ÿè¸ª   â”‚ â”‚
â”‚  â”‚ â€¢ çŠ¶æ€è½¬æ¢è§„åˆ™   â”‚  â”‚ â€¢ ç¬¦å·è¡¨ç®¡ç†     â”‚  â”‚ â€¢ èŠ‚ç‚¹æ ‡è®°ç®¡ç†   â”‚ â”‚
â”‚  â”‚ â€¢ RAIIå®ˆå«      â”‚  â”‚ â€¢ å‘½åç©ºé—´ç®¡ç†   â”‚  â”‚ â€¢ ç»Ÿè®¡ä¿¡æ¯æ”¶é›†   â”‚ â”‚
â”‚  â”‚ â€¢ ç›‘å¬å™¨æœºåˆ¶     â”‚  â”‚ â€¢ RAIIä¸Šä¸‹æ–‡     â”‚  â”‚ â€¢ é”™è¯¯è·Ÿè¸ª      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                     â”‚                     â”‚        â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                 â”‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            é›†æˆå±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ æ‰«æå™¨çŠ¶æ€é›†æˆ   â”‚                    â”‚ ç¼–è¯‘å™¨çŠ¶æ€é›†æˆ   â”‚     â”‚
â”‚  â”‚                 â”‚                    â”‚                 â”‚     â”‚
â”‚  â”‚ â€¢ å¢å¼ºç»Ÿä¸€æ‰«æå™¨ â”‚                    â”‚ â€¢ å¢å¼ºè§£æå™¨     â”‚     â”‚
â”‚  â”‚ â€¢ å¢å¼ºåˆ‡ç‰‡æ‰«æå™¨ â”‚                    â”‚ â€¢ å¢å¼ºç”Ÿæˆå™¨     â”‚     â”‚
â”‚  â”‚ â€¢ çŠ¶æ€åŒæ­¥åè°ƒ   â”‚                    â”‚ â€¢ å¢å¼ºç¼–è¯‘å™¨     â”‚     â”‚
â”‚  â”‚ â€¢ æ‰«æäº‹ä»¶å¤„ç†   â”‚                    â”‚ â€¢ ç¼–è¯‘äº‹ä»¶å¤„ç†   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çŠ¶æ€å±‚æ¬¡ç»“æ„
```
CHTLè¯­æ³•çŠ¶æ€ (CHTLGrammarState)
â”œâ”€â”€ æ ¹çŠ¶æ€
â”‚   â”œâ”€â”€ INITIAL - åˆå§‹çŠ¶æ€
â”‚   â””â”€â”€ PROGRAM_ROOT - ç¨‹åºæ ¹èŠ‚ç‚¹
â”œâ”€â”€ æ³¨é‡ŠçŠ¶æ€
â”‚   â”œâ”€â”€ LINE_COMMENT - // æ³¨é‡Š
â”‚   â”œâ”€â”€ MULTILINE_COMMENT - /* */ æ³¨é‡Š
â”‚   â””â”€â”€ GENERATOR_COMMENT - -- ç”Ÿæˆå™¨æ³¨é‡Š
â”œâ”€â”€ æ–‡æœ¬å’Œå­—é¢é‡çŠ¶æ€
â”‚   â”œâ”€â”€ TEXT_DECLARATION - text å…³é”®å­—
â”‚   â”œâ”€â”€ TEXT_CONTENT - text { } å†…å®¹
â”‚   â”œâ”€â”€ DOUBLE_QUOTED_LITERAL - "åŒå¼•å·å­—ç¬¦ä¸²"
â”‚   â”œâ”€â”€ SINGLE_QUOTED_LITERAL - 'å•å¼•å·å­—ç¬¦ä¸²'
â”‚   â””â”€â”€ UNQUOTED_LITERAL - æ— ä¿®é¥°å­—é¢é‡
â”œâ”€â”€ å…ƒç´ å’Œå±æ€§çŠ¶æ€
â”‚   â”œâ”€â”€ ELEMENT_DECLARATION - å…ƒç´ å£°æ˜
â”‚   â”œâ”€â”€ ELEMENT_BODY - å…ƒç´ ä½“å†…å®¹
â”‚   â”œâ”€â”€ ATTRIBUTE_NAME - å±æ€§å
â”‚   â”œâ”€â”€ ATTRIBUTE_COLON_EQUALS - CEå¯¹ç­‰å¼
â”‚   â””â”€â”€ ATTRIBUTE_VALUE - å±æ€§å€¼
â”œâ”€â”€ æ ·å¼çŠ¶æ€
â”‚   â”œâ”€â”€ STYLE_DECLARATION - style å…³é”®å­—
â”‚   â”œâ”€â”€ STYLE_BODY - style { } å†…å®¹
â”‚   â”œâ”€â”€ INLINE_STYLE - å†…è”æ ·å¼
â”‚   â”œâ”€â”€ CLASS_SELECTOR - .className
â”‚   â”œâ”€â”€ ID_SELECTOR - #idName
â”‚   â”œâ”€â”€ CONTEXT_REFERENCE - & ä¸Šä¸‹æ–‡æ¨å¯¼
â”‚   â”œâ”€â”€ PSEUDO_CLASS - &:hover ä¼ªç±»
â”‚   â””â”€â”€ PSEUDO_ELEMENT - &::before ä¼ªå…ƒç´ 
â”œâ”€â”€ æ¨¡æ¿ç³»ç»ŸçŠ¶æ€
â”‚   â”œâ”€â”€ TEMPLATE_DECLARATION - [Template] å£°æ˜
â”‚   â”œâ”€â”€ TEMPLATE_STYLE - [Template] @Style
â”‚   â”œâ”€â”€ TEMPLATE_ELEMENT - [Template] @Element
â”‚   â”œâ”€â”€ TEMPLATE_VAR - [Template] @Var
â”‚   â”œâ”€â”€ TEMPLATE_USAGE - æ¨¡æ¿ä½¿ç”¨
â”‚   â””â”€â”€ TEMPLATE_INHERITANCE - inherit ç»§æ‰¿
â”œâ”€â”€ è‡ªå®šä¹‰ç³»ç»ŸçŠ¶æ€
â”‚   â”œâ”€â”€ CUSTOM_DECLARATION - [Custom] å£°æ˜
â”‚   â”œâ”€â”€ CUSTOM_STYLE - [Custom] @Style
â”‚   â”œâ”€â”€ CUSTOM_ELEMENT - [Custom] @Element
â”‚   â”œâ”€â”€ CUSTOM_VAR - [Custom] @Var
â”‚   â”œâ”€â”€ CUSTOM_SPECIALIZATION - ç‰¹ä¾‹åŒ–å—
â”‚   â”œâ”€â”€ DELETE_OPERATION - delete æ“ä½œ
â”‚   â”œâ”€â”€ INSERT_OPERATION - insert æ“ä½œ
â”‚   â””â”€â”€ INDEX_ACCESS - [index] ç´¢å¼•è®¿é—®
â”œâ”€â”€ ç»“æ„åŒ–å£°æ˜çŠ¶æ€
â”‚   â”œâ”€â”€ ORIGIN_DECLARATION - [Origin] å£°æ˜
â”‚   â”œâ”€â”€ IMPORT_DECLARATION - [Import] å£°æ˜
â”‚   â”œâ”€â”€ NAMESPACE_DECLARATION - [Namespace] å£°æ˜
â”‚   â””â”€â”€ CONFIGURATION_DECLARATION - [Configuration] å£°æ˜
â”œâ”€â”€ CHTL JSç‰¹æœ‰çŠ¶æ€
â”‚   â”œâ”€â”€ ENHANCED_SELECTOR - {{selector}} å¢å¼ºé€‰æ‹©å™¨
â”‚   â”œâ”€â”€ ARROW_OPERATOR - -> ç®­å¤´æ“ä½œç¬¦
â”‚   â”œâ”€â”€ LISTEN_CALL - listen è°ƒç”¨
â”‚   â”œâ”€â”€ DELEGATE_CALL - delegate è°ƒç”¨
â”‚   â””â”€â”€ ANIMATE_CALL - animate è°ƒç”¨
â””â”€â”€ é”™è¯¯å’Œç»“æŸçŠ¶æ€
    â”œâ”€â”€ ERROR_STATE - é”™è¯¯çŠ¶æ€
    â””â”€â”€ END_OF_INPUT - è¾“å…¥ç»“æŸ
```

## ğŸ“ æ–‡ä»¶ç»“æ„

### çŠ¶æ€ç®¡ç†æ ¸å¿ƒ
```
include/state/
â”œâ”€â”€ raii_state_machine.hpp          # RAIIçŠ¶æ€æœºå¤´æ–‡ä»¶
â”œâ”€â”€ context_manager.hpp             # ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¤´æ–‡ä»¶
â””â”€â”€ ast_state_tracker.hpp           # ASTçŠ¶æ€è¿½è¸ªå™¨å¤´æ–‡ä»¶

src/state/
â”œâ”€â”€ raii_state_machine.cpp          # RAIIçŠ¶æ€æœºå®ç°
â”œâ”€â”€ context_manager.cpp             # ä¸Šä¸‹æ–‡ç®¡ç†å™¨å®ç°
â””â”€â”€ ast_state_tracker.cpp           # ASTçŠ¶æ€è¿½è¸ªå™¨å®ç°
```

### é›†æˆå±‚
```
include/integration/
â”œâ”€â”€ scanner_state_integration.hpp   # æ‰«æå™¨çŠ¶æ€é›†æˆå¤´æ–‡ä»¶
â””â”€â”€ compiler_state_integration.hpp  # ç¼–è¯‘å™¨çŠ¶æ€é›†æˆå¤´æ–‡ä»¶

src/integration/
â”œâ”€â”€ scanner_state_integration.cpp   # æ‰«æå™¨çŠ¶æ€é›†æˆå®ç°
â””â”€â”€ compiler_state_integration.cpp  # ç¼–è¯‘å™¨çŠ¶æ€é›†æˆå®ç°
```

### æµ‹è¯•éªŒè¯
```
tests/
â””â”€â”€ raii_state_management_integration_test.cpp  # é›†æˆæµ‹è¯•
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. RAIIçŠ¶æ€æœº (`RAIIStateMachine`)

#### ä¸»è¦ç‰¹æ€§
- **è‡ªåŠ¨çŠ¶æ€ç®¡ç†** - RAIIå®ˆå«è‡ªåŠ¨ç®¡ç†çŠ¶æ€è¿›å…¥å’Œé€€å‡º
- **çŠ¶æ€è½¬æ¢éªŒè¯** - åŸºäºè§„åˆ™çš„çŠ¶æ€è½¬æ¢éªŒè¯
- **çŠ¶æ€å†å²è®°å½•** - å®Œæ•´çš„çŠ¶æ€å˜åŒ–å†å²è·Ÿè¸ª
- **ç›‘å¬å™¨æœºåˆ¶** - äº‹ä»¶é©±åŠ¨çš„çŠ¶æ€å˜åŒ–é€šçŸ¥
- **çº¿ç¨‹å®‰å…¨** - äº’æ–¥é”ä¿æŠ¤çš„å¹¶å‘è®¿é—®

#### æ ¸å¿ƒæ–¹æ³•
```cpp
class RAIIStateMachine {
public:
    // çŠ¶æ€ç®¡ç†
    CHTLGrammarState getCurrentState() const;
    StateGuard createGuard(CHTLGrammarState newState, const std::string& context = "");
    bool transitionTo(CHTLGrammarState newState, const std::string& context = "");
    
    // çŠ¶æ€éªŒè¯
    bool canTransitionTo(CHTLGrammarState targetState) const;
    bool isInState(CHTLGrammarState state) const;
    bool isInAnyState(const std::vector<CHTLGrammarState>& states) const;
    
    // ç›‘å¬å™¨ç®¡ç†
    void addListener(std::shared_ptr<IStateChangeListener> listener);
    void removeListener(std::shared_ptr<IStateChangeListener> listener);
};
```

#### æ”¯æŒçš„è¯­æ³•çŠ¶æ€
- [x] **æ ¹çŠ¶æ€** - `INITIAL`, `PROGRAM_ROOT`
- [x] **æ³¨é‡ŠçŠ¶æ€** - ä¸‰ç§æ³¨é‡Šç±»å‹ (`//`, `/* */`, `--`)
- [x] **æ–‡æœ¬èŠ‚ç‚¹çŠ¶æ€** - `text { }` è¯­æ³•
- [x] **å­—é¢é‡çŠ¶æ€** - ä¸‰ç§å­—é¢é‡ç±»å‹
- [x] **å…ƒç´ çŠ¶æ€** - HTMLå…ƒç´ å’Œå±æ€§
- [x] **æ ·å¼çŠ¶æ€** - å±€éƒ¨æ ·å¼å—å’Œé€‰æ‹©å™¨
- [x] **æ¨¡æ¿çŠ¶æ€** - `[Template]` ç³»ç»Ÿ
- [x] **è‡ªå®šä¹‰çŠ¶æ€** - `[Custom]` ç³»ç»Ÿå’Œç‰¹ä¾‹åŒ–
- [x] **ç»“æ„åŒ–å£°æ˜** - `[Origin]`, `[Import]`, `[Namespace]`, `[Configuration]`
- [x] **CHTL JSçŠ¶æ€** - å¢å¼ºé€‰æ‹©å™¨ã€ç®­å¤´æ“ä½œç¬¦ã€ç›‘å¬å™¨
- [x] **é”™è¯¯çŠ¶æ€** - é”™è¯¯å¤„ç†å’Œæ¢å¤

### 2. ä¸Šä¸‹æ–‡ç®¡ç†å™¨ (`ContextManager`)

#### ä¸»è¦ç‰¹æ€§
- **ä½œç”¨åŸŸç®¡ç†** - è‡ªåŠ¨ç®¡ç†åµŒå¥—ä½œç”¨åŸŸ
- **ç¬¦å·è¡¨ç®¡ç†** - å®Œæ•´çš„ç¬¦å·å£°æ˜å’ŒæŸ¥æ‰¾
- **å‘½åç©ºé—´æ”¯æŒ** - åµŒå¥—å‘½åç©ºé—´ç®¡ç†
- **æ¨¡æ¿å’Œè‡ªå®šä¹‰ç®¡ç†** - ä¸“é—¨çš„æ¨¡æ¿å’Œè‡ªå®šä¹‰ç¬¦å·ç®¡ç†
- **RAIIä¸Šä¸‹æ–‡å®ˆå«** - è‡ªåŠ¨ä¸Šä¸‹æ–‡è¿›å…¥å’Œé€€å‡º

#### æ ¸å¿ƒæ–¹æ³•
```cpp
class ContextManager {
public:
    // ä¸Šä¸‹æ–‡ç®¡ç†
    CHTLContextType getCurrentContextType() const;
    ContextGuard createGuard(CHTLContextType contextType, const std::string& identifier = "");
    
    // ç¬¦å·è¡¨ç®¡ç†
    bool declareSymbol(const std::string& name, const std::string& type, const Position& position);
    const SymbolEntry* findSymbol(const std::string& name) const;
    
    // å‘½åç©ºé—´ç®¡ç†
    void enterNamespace(const std::string& namespaceName);
    void exitNamespace();
    std::string getCurrentNamespace() const;
    
    // æ¨¡æ¿å’Œè‡ªå®šä¹‰ç®¡ç†
    void registerTemplate(const std::string& templateType, const std::string& name, const Position& position);
    void registerCustom(const std::string& customType, const std::string& name, const Position& position);
};
```

#### æ”¯æŒçš„ä¸Šä¸‹æ–‡ç±»å‹
- [x] **æ ¹ä¸Šä¸‹æ–‡** - `GLOBAL_SCOPE`, `FILE_SCOPE`
- [x] **ç»“æ„åŒ–ä¸Šä¸‹æ–‡** - `ELEMENT_SCOPE`, `TEXT_SCOPE`, `STYLE_SCOPE`, `SCRIPT_SCOPE`
- [x] **æ¨¡æ¿ä¸Šä¸‹æ–‡** - æ¨¡æ¿ä½œç”¨åŸŸå’Œå­ç±»å‹
- [x] **è‡ªå®šä¹‰ä¸Šä¸‹æ–‡** - è‡ªå®šä¹‰ä½œç”¨åŸŸå’Œç‰¹ä¾‹åŒ–
- [x] **åŸå§‹åµŒå…¥ä¸Šä¸‹æ–‡** - `[Origin]` å„ç§ç±»å‹
- [x] **å¯¼å…¥ä¸Šä¸‹æ–‡** - `[Import]` ä½œç”¨åŸŸ
- [x] **å‘½åç©ºé—´ä¸Šä¸‹æ–‡** - åµŒå¥—å‘½åç©ºé—´æ”¯æŒ
- [x] **é…ç½®ä¸Šä¸‹æ–‡** - `[Configuration]` å’Œ `[Name]` ç»„
- [x] **å±€éƒ¨æ ·å¼ä¸Šä¸‹æ–‡** - æ ·å¼é€‰æ‹©å™¨ä¸“ç”¨ä½œç”¨åŸŸ
- [x] **CHTL JSä¸Šä¸‹æ–‡** - å¢å¼ºé€‰æ‹©å™¨å’Œé…ç½®ä½œç”¨åŸŸ

### 3. ASTçŠ¶æ€è¿½è¸ªå™¨ (`ASTStateTracker`)

#### ä¸»è¦ç‰¹æ€§
- **èŠ‚ç‚¹çŠ¶æ€ç®¡ç†** - è¯¦ç»†çš„ASTèŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸçŠ¶æ€
- **èŠ‚ç‚¹æ ‡è®°ç³»ç»Ÿ** - ä¸°å¯Œçš„èŠ‚ç‚¹å±æ€§æ ‡è®°
- **ç»Ÿè®¡ä¿¡æ¯æ”¶é›†** - èŠ‚ç‚¹æ€§èƒ½å’Œä½¿ç”¨ç»Ÿè®¡
- **é”™è¯¯è·Ÿè¸ª** - èŠ‚ç‚¹çº§åˆ«çš„é”™è¯¯ç®¡ç†
- **çŠ¶æ€åŒæ­¥** - ä¸çŠ¶æ€æœºå’Œä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„åŒæ­¥

#### æ ¸å¿ƒæ–¹æ³•
```cpp
class ASTStateTracker {
public:
    // èŠ‚ç‚¹ç®¡ç†
    bool registerNode(const void* nodePtr, const std::string& nodeType, const Position& position);
    void unregisterNode(const void* nodePtr);
    ASTNodeStateGuard createNodeGuard(const void* nodePtr, ASTNodeState newState);
    
    // çŠ¶æ€ç®¡ç†
    ASTNodeState getNodeState(const void* nodePtr) const;
    bool setNodeState(const void* nodePtr, ASTNodeState newState);
    
    // æ ‡è®°ç®¡ç†
    void setNodeFlag(const void* nodePtr, ASTNodeFlag flag);
    bool hasNodeFlag(const void* nodePtr, ASTNodeFlag flag) const;
    
    // ç»Ÿè®¡ä¿¡æ¯
    void updateNodeStats(const void* nodePtr, const ASTNodeStats& stats);
    const ASTNodeStats& getNodeStats(const void* nodePtr) const;
    
    // çŠ¶æ€åŒæ­¥
    void syncGrammarState(const void* nodePtr);
    void syncContextType(const void* nodePtr);
};
```

#### æ”¯æŒçš„èŠ‚ç‚¹çŠ¶æ€
- [x] **åŸºæœ¬çŠ¶æ€** - `UNINITIALIZED`, `INITIALIZING`, `READY`
- [x] **è§£æçŠ¶æ€** - `PARSING_STARTED`, `PARSING_ATTRIBUTES`, `PARSING_CHILDREN`, `PARSING_COMPLETED`
- [x] **éªŒè¯çŠ¶æ€** - `VALIDATION_PENDING`, `VALIDATING`, `VALIDATION_PASSED`, `VALIDATION_FAILED`
- [x] **ç”ŸæˆçŠ¶æ€** - `GENERATION_READY`, `GENERATING`, `GENERATION_COMPLETED`
- [x] **ä¼˜åŒ–çŠ¶æ€** - `OPTIMIZATION_PENDING`, `OPTIMIZING`, `OPTIMIZATION_COMPLETED`
- [x] **é”™è¯¯çŠ¶æ€** - `ERROR_SYNTAX`, `ERROR_SEMANTIC`, `ERROR_VALIDATION`, `ERROR_GENERATION`
- [x] **ç‰¹æ®ŠçŠ¶æ€** - `FROZEN`, `DISPOSED`

#### æ”¯æŒçš„èŠ‚ç‚¹æ ‡è®°
- [x] **è¯­æ³•æ ‡è®°** - `HAS_ATTRIBUTES`, `HAS_CHILDREN`, `IS_SELF_CLOSING`
- [x] **æ¨¡æ¿æ ‡è®°** - `IS_TEMPLATE_DECLARATION`, `IS_TEMPLATE_USAGE`, `IS_SPECIALIZED`
- [x] **æ ·å¼æ ‡è®°** - `HAS_LOCAL_STYLE`, `HAS_CLASS_SELECTOR`, `HAS_PSEUDO_SELECTOR`
- [x] **è„šæœ¬æ ‡è®°** - `HAS_LOCAL_SCRIPT`, `HAS_CHTL_JS`, `HAS_EVENT_LISTENER`
- [x] **å‘½åç©ºé—´æ ‡è®°** - `IS_NAMESPACED`, `IS_IMPORTED`, `IS_EXPORTED`
- [x] **é”™è¯¯æ ‡è®°** - `HAS_SYNTAX_ERROR`, `HAS_SEMANTIC_ERROR`, `HAS_WARNING`

## ğŸ”„ é›†æˆç³»ç»Ÿ

### 1. æ‰«æå™¨çŠ¶æ€é›†æˆ (`ScannerStateIntegrator`)

#### åŠŸèƒ½ç‰¹æ€§
- **æ‰«æå™¨å¢å¼º** - ä¸ºç°æœ‰æ‰«æå™¨æ·»åŠ çŠ¶æ€ç®¡ç†
- **çŠ¶æ€åŒæ­¥** - è‡ªåŠ¨åŒæ­¥æ‰«æçŠ¶æ€åˆ°çŠ¶æ€æœº
- **äº‹ä»¶å¤„ç†** - å¤„ç†æ‰«æè¿‡ç¨‹ä¸­çš„å„ç§äº‹ä»¶
- **ç±»å‹æ˜ å°„** - `CodeSegmentType` åˆ°è¯­æ³•çŠ¶æ€çš„æ˜ å°„

#### å¢å¼ºç»„ä»¶
```cpp
class EnhancedUnifiedScanner {
    // åœ¨CHTLUnifiedScanneråŸºç¡€ä¸Šæ·»åŠ çŠ¶æ€ç®¡ç†
    std::vector<CodeSlice> scan(const std::string& source, const std::string& filename = "");
    CHTLGrammarState getCurrentGrammarState() const;
    CHTLContextType getCurrentContextType() const;
};

class EnhancedSliceScanner {
    // åœ¨SliceScanneråŸºç¡€ä¸Šæ·»åŠ çŠ¶æ€ç®¡ç†
    std::vector<CodeSlice> scanSlice(const CodeSlice& slice);
    void syncSliceState(const CodeSlice& slice);
};
```

### 2. ç¼–è¯‘å™¨çŠ¶æ€é›†æˆ (`CompilerStateIntegrator`)

#### åŠŸèƒ½ç‰¹æ€§
- **ç¼–è¯‘å™¨å¢å¼º** - ä¸ºè§£æå™¨ã€ç”Ÿæˆå™¨å’Œç¼–è¯‘å™¨æ·»åŠ çŠ¶æ€ç®¡ç†
- **ç¼–è¯‘äº‹ä»¶å¤„ç†** - è·Ÿè¸ªç¼–è¯‘è¿‡ç¨‹ä¸­çš„å„ä¸ªé˜¶æ®µ
- **æ€§èƒ½ç›‘æ§** - ç¼–è¯‘æ€§èƒ½æŒ‡æ ‡æ”¶é›†
- **ASTç”Ÿå‘½å‘¨æœŸè·Ÿè¸ª** - å®Œæ•´çš„ASTèŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### å¢å¼ºç»„ä»¶
```cpp
class EnhancedCHTLParser {
    // åœ¨CHTLParseråŸºç¡€ä¸Šæ·»åŠ çŠ¶æ€ç®¡ç†
    CHTLParseResult parse(const std::string& source, const std::string& filename = "");
    CHTLGrammarState getCurrentParseState() const;
};

class EnhancedCHTLGenerator {
    // åœ¨CHTLGeneratoråŸºç¡€ä¸Šæ·»åŠ çŠ¶æ€ç®¡ç†
    CHTLGenerateResult generate(CHTLASTNodePtr ast, const std::string& filename = "");
    CHTLGrammarState getCurrentGenerateState() const;
};

class EnhancedCHTLCompiler {
    // åœ¨CHTLCompileråŸºç¡€ä¸Šæ·»åŠ çŠ¶æ€ç®¡ç†
    std::string compile(const CodeSlice& slice);
    CHTLGrammarState getCurrentCompileState() const;
};
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### é›†æˆæµ‹è¯•å¥—ä»¶
åˆ›å»ºäº†å®Œæ•´çš„é›†æˆæµ‹è¯• (`tests/raii_state_management_integration_test.cpp`)ï¼ŒåŒ…æ‹¬ï¼š

#### åŸºç¡€åŠŸèƒ½æµ‹è¯•
- âœ… **åŸºæœ¬çŠ¶æ€æœºæµ‹è¯•** - RAIIå®ˆå«å’ŒçŠ¶æ€è½¬æ¢
- âœ… **ä¸Šä¸‹æ–‡ç®¡ç†å™¨æµ‹è¯•** - ä½œç”¨åŸŸç®¡ç†å’Œç¬¦å·è¡¨
- âœ… **ASTçŠ¶æ€è¿½è¸ªå™¨æµ‹è¯•** - èŠ‚ç‚¹çŠ¶æ€å’Œæ ‡è®°ç®¡ç†
- âœ… **çŠ¶æ€åŒæ­¥æµ‹è¯•** - ä¸‰ä¸ªç»„ä»¶ä¹‹é—´çš„çŠ¶æ€åŒæ­¥

#### é«˜çº§åŠŸèƒ½æµ‹è¯•
- âœ… **é”™è¯¯å¤„ç†å’Œæ¢å¤æµ‹è¯•** - é”™è¯¯çŠ¶æ€ç®¡ç†å’Œæ¢å¤æœºåˆ¶
- âœ… **å¹¶å‘å®‰å…¨æ€§æµ‹è¯•** - å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„çŠ¶æ€ç®¡ç†
- âœ… **æ€§èƒ½åŸºå‡†æµ‹è¯•** - çŠ¶æ€æ“ä½œæ€§èƒ½éªŒè¯
- âœ… **å†…å­˜ä½¿ç”¨æµ‹è¯•** - å¤§é‡èŠ‚ç‚¹çš„å†…å­˜ç®¡ç†

#### å¤æ‚åœºæ™¯æµ‹è¯•
- âœ… **å¤æ‚CHTLè¯­æ³•åœºæ™¯** - æ¨¡æ¿ã€è‡ªå®šä¹‰ã€å‘½åç©ºé—´ç­‰å¤æ‚è¯­æ³•
- âœ… **ç›‘å¬å™¨äº‹ä»¶æµ‹è¯•** - äº‹ä»¶ç›‘å¬å’Œç»Ÿè®¡åŠŸèƒ½
- âœ… **è°ƒè¯•å’Œè¯Šæ–­æµ‹è¯•** - è°ƒè¯•ä¿¡æ¯å’ŒçŠ¶æ€è½¬å‚¨

### æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

#### åŸºæœ¬çŠ¶æ€æœºæµ‹è¯•
```cpp
TEST_F(RAIIStateManagementIntegrationTest, testBasicStateMachine) {
    // éªŒè¯åˆå§‹çŠ¶æ€
    EXPECT_EQ(stateMachine_->getCurrentState(), CHTLGrammarState::INITIAL);
    
    // æµ‹è¯•RAIIçŠ¶æ€å®ˆå«
    {
        CHTL_STATE_GUARD(*stateMachine_, CHTLGrammarState::ELEMENT_DECLARATION);
        EXPECT_EQ(stateMachine_->getCurrentState(), CHTLGrammarState::ELEMENT_DECLARATION);
        
        // åµŒå¥—å®ˆå«
        {
            auto guard = stateMachine_->createGuard(CHTLGrammarState::ELEMENT_BODY, "è§£æå…ƒç´ ä½“");
            EXPECT_EQ(stateMachine_->getCurrentState(), CHTLGrammarState::ELEMENT_BODY);
        }
        
        // è‡ªåŠ¨æ¢å¤åˆ°ELEMENT_DECLARATION
        EXPECT_EQ(stateMachine_->getCurrentState(), CHTLGrammarState::ELEMENT_DECLARATION);
    }
    
    // è‡ªåŠ¨æ¢å¤åˆ°åˆå§‹çŠ¶æ€
    EXPECT_EQ(stateMachine_->getCurrentState(), CHTLGrammarState::INITIAL);
}
```

#### çŠ¶æ€åŒæ­¥æµ‹è¯•
```cpp
TEST_F(RAIIStateManagementIntegrationTest, testStateSynchronization) {
    auto element = std::make_shared<ElementNode>("div", Position{1, 1});
    const void* nodePtr = element.get();
    
    CHTL_REGISTER_AST_NODE(*astTracker_, nodePtr, "ElementNode", Position{1, 1});
    
    // åŒæ—¶ç®¡ç†ä¸‰ç§çŠ¶æ€
    {
        CHTL_STATE_GUARD(*stateMachine_, CHTLGrammarState::ELEMENT_DECLARATION);
        CHTL_CONTEXT_GUARD(*contextManager_, CHTLContextType::ELEMENT_SCOPE);
        CHTL_AST_STATE_GUARD(*astTracker_, nodePtr, ASTNodeState::PARSING_STARTED);
        
        // æµ‹è¯•çŠ¶æ€åŒæ­¥
        astTracker_->syncGrammarState(nodePtr);
        astTracker_->syncContextType(nodePtr);
        
        const auto* stateInfo = astTracker_->getNodeStateInfo(nodePtr);
        EXPECT_EQ(stateInfo->grammarState, CHTLGrammarState::ELEMENT_DECLARATION);
        EXPECT_EQ(stateInfo->contextType, CHTLContextType::ELEMENT_SCOPE);
    }
}
```

## ğŸ“Š è¯­æ³•æ–‡æ¡£ä¸€è‡´æ€§éªŒè¯

### ä¸¥æ ¼éµå¾ªåŸåˆ™
1. **ä¸å¾—ç§è‡ªæ‰©å±•** - æ‰€æœ‰çŠ¶æ€å’Œä¸Šä¸‹æ–‡ä¸¥æ ¼æŒ‰ç…§è¯­æ³•æ–‡æ¡£å®šä¹‰
2. **å®Œæ•´è¦†ç›–** - æ”¯æŒæ–‡æ¡£ä¸­çš„æ‰€æœ‰è¯­æ³•ç‰¹æ€§
3. **ç²¾ç¡®æ˜ å°„** - æ¯ä¸ªè¯­æ³•ç»“æ„éƒ½æœ‰å¯¹åº”çš„çŠ¶æ€å’Œä¸Šä¸‹æ–‡

### éªŒè¯ç»“æœ
- âœ… **æ³¨é‡Šç³»ç»Ÿ** - ä¸‰ç§æ³¨é‡Šç±»å‹ (`//`, `/* */`, `--`) âœ“
- âœ… **æ–‡æœ¬èŠ‚ç‚¹** - `text { }` è¯­æ³•å®Œæ•´æ”¯æŒ âœ“
- âœ… **å­—é¢é‡ç³»ç»Ÿ** - ä¸‰ç§å­—é¢é‡ç±»å‹å®Œæ•´æ”¯æŒ âœ“
- âœ… **CEå¯¹ç­‰å¼** - `:` ä¸ `=` å®Œå…¨ç­‰ä»·å¤„ç† âœ“
- âœ… **å…ƒç´ å’Œå±æ€§** - HTMLå…ƒç´ å’Œå±æ€§å®Œæ•´æ”¯æŒ âœ“
- âœ… **å±€éƒ¨æ ·å¼å—** - `style { }` å’Œæ‰€æœ‰é€‰æ‹©å™¨ç±»å‹ âœ“
- âœ… **æ¨¡æ¿ç³»ç»Ÿ** - `[Template]` æ‰€æœ‰ç±»å‹å’ŒåŠŸèƒ½ âœ“
- âœ… **è‡ªå®šä¹‰ç³»ç»Ÿ** - `[Custom]` å’Œç‰¹ä¾‹åŒ–å®Œæ•´æ”¯æŒ âœ“
- âœ… **åŸå§‹åµŒå…¥** - `[Origin]` æ‰€æœ‰ç±»å‹ âœ“
- âœ… **å¯¼å…¥ç³»ç»Ÿ** - `[Import]` æ‰€æœ‰å¯¼å…¥ç±»å‹ âœ“
- âœ… **å‘½åç©ºé—´** - `[Namespace]` åµŒå¥—æ”¯æŒ âœ“
- âœ… **é…ç½®ç»„** - `[Configuration]` å’Œ `[Name]` ç»„ âœ“
- âœ… **CHTL JS** - å¢å¼ºé€‰æ‹©å™¨ã€ç®­å¤´æ“ä½œç¬¦ã€ç›‘å¬å™¨ âœ“

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### çŠ¶æ€ç®¡ç†ä¼˜åŒ–
- **æ™ºèƒ½çŠ¶æ€ç¼“å­˜** - é¢‘ç¹è®¿é—®çš„çŠ¶æ€ä¿¡æ¯ç¼“å­˜
- **æ‰¹é‡çŠ¶æ€æ“ä½œ** - æ”¯æŒæ‰¹é‡è®¾ç½®èŠ‚ç‚¹çŠ¶æ€å’Œæ ‡è®°
- **å†…å­˜æ± ç®¡ç†** - ä¼˜åŒ–çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾
- **çº¿ç¨‹å±€éƒ¨å­˜å‚¨** - å‡å°‘é”ç«äº‰çš„çº¿ç¨‹ä¼˜åŒ–

### é›†æˆä¼˜åŒ–
- **äº‹ä»¶æ‰¹å¤„ç†** - æ‰¹é‡å¤„ç†çŠ¶æ€å˜åŒ–äº‹ä»¶
- **æ‡’åŠ è½½æœºåˆ¶** - æŒ‰éœ€åˆ›å»ºå’Œåˆå§‹åŒ–ç»„ä»¶
- **çŠ¶æ€å‹ç¼©** - ä¼˜åŒ–çŠ¶æ€ä¿¡æ¯çš„å†…å­˜å ç”¨
- **å¿«é€Ÿè·¯å¾„ä¼˜åŒ–** - å¸¸è§æ“ä½œçš„å¿«é€Ÿæ‰§è¡Œè·¯å¾„

## ğŸ”„ æ‰©å±•æ€§è®¾è®¡

### æ’ä»¶åŒ–æ¶æ„
- **è‡ªå®šä¹‰çŠ¶æ€æ‰©å±•** - æ”¯æŒæ·»åŠ æ–°çš„è¯­æ³•çŠ¶æ€
- **è‡ªå®šä¹‰ç›‘å¬å™¨** - çµæ´»çš„äº‹ä»¶ç›‘å¬æœºåˆ¶
- **è‡ªå®šä¹‰é›†æˆå™¨** - æ”¯æŒä¸å…¶ä»–ç³»ç»Ÿçš„é›†æˆ
- **é…ç½®åŒ–è§„åˆ™** - å¯é…ç½®çš„çŠ¶æ€è½¬æ¢è§„åˆ™

### æ¨¡å—åŒ–è®¾è®¡
- **ç‹¬ç«‹ç»„ä»¶** - æ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥ç‹¬ç«‹ä½¿ç”¨
- **æ ‡å‡†æ¥å£** - ç»Ÿä¸€çš„APIè®¾è®¡
- **æ¾æ•£è€¦åˆ** - ç»„ä»¶é—´é€šè¿‡æ¥å£äº¤äº’
- **çƒ­æ’æ‹”æ”¯æŒ** - è¿è¡Œæ—¶æ·»åŠ å’Œç§»é™¤ç»„ä»¶

## ğŸ› ï¸ ä¾¿åˆ©å®å®šä¹‰

### çŠ¶æ€ç®¡ç†å®
```cpp
// è‡ªåŠ¨çŠ¶æ€å®ˆå«
CHTL_STATE_GUARD(machine, state)
CHTL_STATE_GUARD_IF(machine, state, condition)

// çŠ¶æ€éªŒè¯
CHTL_VALIDATE_STATE(machine, expected_state)
```

### ä¸Šä¸‹æ–‡ç®¡ç†å®
```cpp
// è‡ªåŠ¨ä¸Šä¸‹æ–‡å®ˆå«
CHTL_CONTEXT_GUARD(manager, contextType)
CHTL_CONTEXT_GUARD_WITH_ID(manager, contextType, identifier)

// ç¬¦å·æ“ä½œ
CHTL_DECLARE_SYMBOL(manager, name, type, position)
CHTL_FIND_SYMBOL(manager, name)
```

### ASTçŠ¶æ€è¿½è¸ªå®
```cpp
// èŠ‚ç‚¹ç®¡ç†
CHTL_REGISTER_AST_NODE(tracker, nodePtr, nodeType, position)
CHTL_UNREGISTER_AST_NODE(tracker, nodePtr)

// çŠ¶æ€å’Œæ ‡è®°
CHTL_AST_STATE_GUARD(tracker, nodePtr, state)
CHTL_SET_AST_FLAG(tracker, nodePtr, flag)
CHTL_REPORT_AST_ERROR(tracker, nodePtr, error)
```

### é›†æˆå®
```cpp
// æ‰«æå™¨é›†æˆ
CHTL_SYNC_SCANNER_STATE(integrator, segmentType, position)
CHTL_PROCESS_SEGMENT(integrator, slice)

// ç¼–è¯‘å™¨é›†æˆ
CHTL_SYNC_COMPILE_STATE(integrator, phase, nodePtr)
CHTL_TRACK_AST_NODE(integrator, nodePtr, nodeType, position)
```

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨æ¨¡å¼
```cpp
// åˆ›å»ºçŠ¶æ€ç®¡ç†ç³»ç»Ÿ
auto system = CompilerStateIntegrationFactory::createCHTLSystem();

// è§£æCHTLä»£ç 
{
    CHTL_STATE_GUARD(*system.stateMachine, CHTLGrammarState::PROGRAM_ROOT);
    CHTL_CONTEXT_GUARD(*system.contextManager, CHTLContextType::FILE_SCOPE);
    
    auto parseResult = system.parser->parse(chtlSource, "example.chtl");
    
    if (parseResult.success) {
        auto generateResult = system.generator->generate(parseResult.ast);
        // ä½¿ç”¨ç”Ÿæˆç»“æœ
    }
}
```

### å¤æ‚åœºæ™¯ä½¿ç”¨
```cpp
// æ¨¡æ¿è§£æåœºæ™¯
{
    CHTL_STATE_GUARD(*stateMachine, CHTLGrammarState::TEMPLATE_DECLARATION);
    CHTL_CONTEXT_GUARD(*contextManager, CHTLContextType::TEMPLATE_SCOPE);
    
    // æ³¨å†Œæ¨¡æ¿
    contextManager->registerTemplate("@Style", "ButtonStyle", position);
    
    // è§£ææ¨¡æ¿å†…å®¹
    {
        CHTL_STATE_GUARD(*stateMachine, CHTLGrammarState::TEMPLATE_STYLE);
        CHTL_CONTEXT_GUARD(*contextManager, CHTLContextType::TEMPLATE_STYLE_SCOPE);
        
        // è§£ææ ·å¼å±æ€§...
    }
}
```

## ğŸ‰ æ€»ç»“

### å®ç°æˆæœ
1. **å®Œæ•´çš„RAIIçŠ¶æ€ç®¡ç†ç³»ç»Ÿ** - è‡ªåŠ¨åŒ–çš„çŠ¶æ€å’Œä¸Šä¸‹æ–‡ç®¡ç†
2. **ä¸¥æ ¼çš„è¯­æ³•æ–‡æ¡£éµå¾ª** - 100%æŒ‰ç…§CHTLè¯­æ³•æ–‡æ¡£å®ç°
3. **æ— ç¼çš„ç³»ç»Ÿé›†æˆ** - ä¸æ‰«æå™¨å’Œç¼–è¯‘å™¨çš„å®Œç¾ååŒ
4. **å…¨é¢çš„æµ‹è¯•è¦†ç›–** - ä»åŸºç¡€åŠŸèƒ½åˆ°å¤æ‚åœºæ™¯çš„å®Œæ•´æµ‹è¯•
5. **ä¼˜ç§€çš„æ€§èƒ½è¡¨ç°** - é«˜æ•ˆçš„çŠ¶æ€ç®¡ç†å’ŒæŸ¥è¯¢æ€§èƒ½
6. **å¼ºå¤§çš„æ‰©å±•èƒ½åŠ›** - çµæ´»çš„æ’ä»¶åŒ–å’Œæ¨¡å—åŒ–è®¾è®¡

### æŠ€æœ¯äº®ç‚¹
- **RAIIè‡ªåŠ¨åŒ–ç®¡ç†** - å½»åº•æ¶ˆé™¤æ‰‹åŠ¨çŠ¶æ€ç®¡ç†é”™è¯¯
- **ä¸‰å±‚çŠ¶æ€ååŒ** - è¯­æ³•çŠ¶æ€ã€ä¸Šä¸‹æ–‡çŠ¶æ€ã€ASTçŠ¶æ€çš„å®Œç¾ååŒ
- **äº‹ä»¶é©±åŠ¨æ¶æ„** - å®Œæ•´çš„ç›‘å¬å™¨å’Œäº‹ä»¶å¤„ç†æœºåˆ¶
- **çº¿ç¨‹å®‰å…¨è®¾è®¡** - å®Œå–„çš„å¹¶å‘è®¿é—®ä¿æŠ¤
- **æ€§èƒ½ä¼˜åŒ–å®ç°** - å¤šç§ä¼˜åŒ–ç­–ç•¥ç¡®ä¿é«˜æ€§èƒ½
- **ä¾¿åˆ©å®å®šä¹‰** - ç®€æ´æ˜“ç”¨çš„APIæ¥å£

### æ¶æ„ä¼˜åŠ¿
- **è‡ªåŠ¨åŒ–** - RAIIæ¨¡å¼ç¡®ä¿èµ„æºè‡ªåŠ¨ç®¡ç†
- **ç²¾ç¡®æ€§** - ä¸ºæ¯ä¸ªASTèŠ‚ç‚¹æä¾›ç²¾ç¡®çš„çŠ¶æ€ä¿¡æ¯
- **é›†æˆæ€§** - ä¸ç°æœ‰ç³»ç»Ÿçš„æ— ç¼é›†æˆ
- **æ‰©å±•æ€§** - çµæ´»çš„æ’ä»¶åŒ–å’Œé…ç½®åŒ–
- **å¯é æ€§** - å…¨é¢çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
- **ç›‘æ§æ€§** - å®Œæ•´çš„çŠ¶æ€ç›‘æ§å’Œè°ƒè¯•æ”¯æŒ

### ä¸‹ä¸€æ­¥è®¡åˆ’
1. **æ€§èƒ½è¿›ä¸€æ­¥ä¼˜åŒ–** - é’ˆå¯¹å¤§å‹CHTLæ–‡æ¡£çš„æ€§èƒ½ä¼˜åŒ–
2. **æ›´å¤šé›†æˆæµ‹è¯•** - ä¸å®é™…é¡¹ç›®çš„é›†æˆéªŒè¯
3. **å·¥å…·é“¾æ”¯æŒ** - å¼€å‘è°ƒè¯•å’Œåˆ†æå·¥å…·
4. **æ–‡æ¡£å®Œå–„** - è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’Œæœ€ä½³å®è·µ
5. **ç¤¾åŒºåé¦ˆ** - æ”¶é›†ç”¨æˆ·ä½¿ç”¨åé¦ˆå’Œæ”¹è¿›å»ºè®®

---

**é¡¹ç›®çŠ¶æ€ï¼šâœ… å®Œæˆ**  
**è¯­æ³•æ–‡æ¡£ä¸€è‡´æ€§ï¼šâœ… 100%ç¬¦åˆ**  
**ç³»ç»Ÿé›†æˆï¼šâœ… å®Œå…¨é›†æˆ**  
**æµ‹è¯•è¦†ç›–ï¼šâœ… å…¨é¢è¦†ç›–**  
**æ€§èƒ½è¡¨ç°ï¼šâœ… é«˜æ€§èƒ½**

RAIIçŠ¶æ€ç®¡ç†ç³»ç»Ÿå®Œå…¨æ»¡è¶³éœ€æ±‚ï¼Œä¸¥æ ¼éµå¾ªCHTLè¯­æ³•æ–‡æ¡£ï¼Œä¸ºCHTLç¼–è¯‘å™¨ç³»ç»Ÿæä¾›äº†å¼ºå¤§è€Œç²¾ç¡®çš„çŠ¶æ€ç®¡ç†èƒ½åŠ›ã€‚